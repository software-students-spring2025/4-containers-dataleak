{% extends "base.html" %}
{% block content %}
<div class="container">
  <h2>Add Food Item</h2>
  <p>Hold a food item up to your camera. We'll automatically recognize and add it to your virtual fridge.</p>

  <div id="camera-container">
    <video id="video" width="400" height="300" autoplay></video>
    <button id="snap">Capture</button>
    <canvas id="canvas" width="400" height="300" style="display:none;"></canvas>
  </div>

  <form id="upload-form" method="POST" enctype="multipart/form-data" action="{{ url_for('add_food') }}">
    <input type="hidden" name="image_data" id="image_data">
    <button type="submit">Add to Fridge</button>
  </form>
</div>

<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const snap = document.getElementById('snap');
  const imageInput = document.getElementById('image_data');

  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
    })
    .catch(err => {
      console.error("Error accessing camera: ", err);
    });

  snap.addEventListener("click", () => {
    const context = canvas.getContext('2d');
    context.drawImage(video, 0, 0, canvas.width, canvas.height);
    const imageDataURL = canvas.toDataURL('image/png');
    imageInput.value = imageDataURL;
  });
</script>
{% endblock %}
